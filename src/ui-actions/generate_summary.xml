<record_update table="sys_ui_action">
    <sys_ui_action action="ai_generate_worknotes"
                   active="true"
                   client="false"
                   form_button="true"
                   name="AI - Generate Worknotes"
                   table="sn_hr_core_case">
        <condition>
            current.sys_id && current.state != 'closed';
        </condition>
        <script>
            // Generate AI summary & suggestions and append to Work notes
            try {
                var summariser = new HRCaseAISummariser();
                var result = summariser.summariseCase(current.getUniqueValue());
                // result: { case_summary, key_facts, resolution_options, draft_note_employee, draft_work_note }

                var ln = '\n';
                var workNote = '';

                workNote += '=== AI-generated case summary and suggestions ===' + ln;

                if (result.case_summary && result.case_summary.length &gt; 0) {
                    workNote += ln + 'Case Summary:' + ln;
                    for (var i = 0; i &lt; result.case_summary.length; i++) {
                        workNote += '- ' + result.case_summary[i] + ln;
                    }
                }

                if (result.key_facts && result.key_facts.length &gt; 0) {
                    workNote += ln + 'Key Facts and Considerations:' + ln;
                    for (var j = 0; j &lt; result.key_facts.length; j++) {
                        workNote += '- ' + result.key_facts[j] + ln;
                    }
                }

                if (result.resolution_options && result.resolution_options.length &gt; 0) {
                    workNote += ln + 'Suggested Resolution Options:' + ln;
                    for (var k = 0; k &lt; result.resolution_options.length; k++) {
                        workNote += '- ' + result.resolution_options[k] + ln;
                    }
                }

                if (result.draft_work_note) {
                    workNote += ln + 'AI Draft Internal Work Note:' + ln;
                    workNote += result.draft_work_note + ln;
                }

                workNote += ln + '(Generated by AI assistant. Please review and adjust before acting.)';

                if (current.work_notes) {
                    current.work_notes = current.work_notes + '\n\n' + workNote;
                } else {
                    current.work_notes = workNote;
                }

                current.update();
                gs.addInfoMessage('AI summary and suggestions have been added to Work notes.');
            } catch (e) {
                gs.error('AI HR Case worknotes UI Action error: ' + e);
                gs.addErrorMessage('Failed to generate AI summary: ' + e);
            }

            action.setRedirectURL(current);
        </script>
    </sys_ui_action>
</record_update>
